'use strict';

var _ = require('underscore');
var FileSet = require('./FileSet');

/**
 * @typedef {Object} GroupSpec
 * @property {string} name
 * @property {string[]} files
 * @property {Object} options
 */

/**
 * Builds groups using config.
 *
 * @param {Object} config
 * @param {string[]} [files] Files that need to be linted.
 * @returns {GroupSpec[]}
 */
module.exports = function buildGroups(config, files) {
    var res = [];

    var groups = config.groups;
    if (!groups) {
        return res;
    }

    var commonOptions = config.options;
    Object.keys(groups).forEach(function (name) {
        var group = groups[name];
        var fileSet = new FileSet(group.includes, group.excludes);
        res.push({
            name: name,
            files: files ? fileSet.matchFiles(files) : fileSet.findFiles(),
            options: _.extend({}, commonOptions, group.options)
        });
    });

    return res;
};
